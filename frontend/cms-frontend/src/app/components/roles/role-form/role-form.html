<div class="container-fluid p-0">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="mb-0">
        {{ isEditMode ? 'Edit Role' : 'Create Role' }}
      </h3>
      <p class="text-muted mb-0">
        {{ isEditMode ? 'Update role permissions' : 'Define a new role with specific permissions' }}
      </p>
    </div>
    
    <!-- Back Button -->
    <div>
      <button (click)="cancel()" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Back to Roles
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading role...</p>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="bi bi-check-circle me-2"></i>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ errorMessage }}
  </div>

  <!-- Role Form -->
  <form *ngIf="!isLoading" (ngSubmit)="onSubmit()" #roleForm="ngForm">
    <div class="row">
      <!-- Left Column: Basic Info -->
      <div class="col-lg-4">
        <!-- Name -->
        <div class="card mb-3">
          <div class="card-body">
            <label for="name" class="form-label fw-bold">Role Name *</label>
            <input
              type="text"
              class="form-control"
              id="name"
              name="name"
              [(ngModel)]="name"
              required
              placeholder="Editor, Moderator"
              [disabled]="isSubmitting"
            />
          </div>
        </div>

        <!-- Description -->
        <div class="card mb-3">
          <div class="card-body">
            <label for="description" class="form-label fw-bold">Description *</label>
            <textarea
              class="form-control"
              id="description"
              name="description"
              [(ngModel)]="description"
              required
              rows="4"
              placeholder="Describe what this role can do..."
              [disabled]="isSubmitting"
            ></textarea>
          </div>
        </div>

        <!-- Summary -->
        <div class="card">
          <div class="card-body">
            <h6 class="card-title fw-bold">Summary</h6>
            <ul class="list-unstyled small">
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-1"></i>
                {{ getSelectedCount() }} of {{ getTotalCount() }} permissions selected
              </li>
              <li class="mb-2">
                <i class="bi bi-info-circle text-primary me-1"></i>
                Required fields are marked with *
              </li>
              <li class="mb-2" *ngIf="!authService.hasRole('SuperAdmin')">
                <i class="bi bi-exclamation-triangle text-warning me-1"></i>
                Only SuperAdmin can create/edit roles
              </li>
            </ul>

            <!-- Submit Buttons -->
            <div class="d-grid gap-2 mt-3">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSubmitting || !roleForm.form.valid || getSelectedCount() === 0"
              >
                <span *ngIf="!isSubmitting">
                  <i class="bi bi-save me-1"></i>
                  {{ isEditMode ? 'Update Role' : 'Create Role' }}
                </span>
                <span *ngIf="isSubmitting">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  {{ isEditMode ? 'Updating...' : 'Creating...' }}
                </span>
              </button>

              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="cancel()"
                [disabled]="isSubmitting"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Permissions -->
      <div class="col-lg-8">
        <!-- Permissions Header -->
        <div class="card mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">
                <i class="bi bi-shield-lock me-2"></i>
                Permissions
              </h5>
              <div class="text-muted">
                {{ getSelectedCount() }} selected
              </div>
            </div>
          </div>
        </div>

        <!-- Permission Groups -->
        <div *ngFor="let module of permissionModuleKeys" class="card mb-3">
          <div class="card-body">
            <!-- Group Header -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="card-title mb-0">
                <i class="bi bi-folder me-2"></i>
                {{ module }}
              </h6>
              <div>
                <button type="button" 
                        class="btn btn-sm btn-outline-primary me-2"
                        (click)="selectAllInGroup(module)"
                        [disabled]="isSubmitting">
                  Select All
                </button>
                <button type="button" 
                        class="btn btn-sm btn-outline-secondary"
                        (click)="deselectAllInGroup(module)"
                        [disabled]="isSubmitting">
                  Deselect All
                </button>
              </div>
            </div>

            <!-- Permissions Checkboxes -->
            <div class="row">
              <div *ngFor="let perm of permissionGroups[module]" class="col-md-6 mb-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [id]="perm.name"
                    [checked]="isPermissionSelected(perm.name)"
                    (change)="togglePermission(perm.name)"
                    [disabled]="isSubmitting"
                  />
                  <label class="form-check-label" [for]="perm.name">
                    <strong>{{ perm.label }}</strong>
                    <div class="small text-muted">
                      {{ perm.name }}
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>